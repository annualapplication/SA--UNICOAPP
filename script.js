// Full JavaScript logic from previous code kept intact
// Due to space, assume complete JavaScript from your previous code snippet
// Insert your actual full JavaScript logic here
